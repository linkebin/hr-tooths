<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<title>首页</title>
		<meta name="renderer" content="webkit">
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
		<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
		<link rel="stylesheet" href="../../../Styles/themes/default/style.css" media="all">
		<link rel="stylesheet" href="../../../Styles/themes/default/cover-style.css" media="all">
	</head>

	<body>

		<div class="eui-row">
			<div class="eui-col-md3">
				<div class="eui-row eui-margin10 eui-padding10 eui-tab-card  eui-borderRadiusLR1">
					<div class="eui-col-md6 eui-textAlignC">
						<a href="#" class="eui-textIn1">
							<p class="eui-textNum"><span class="eui-color-blue" id="time2">10</span> 个</p>
							<p class="name">今日预约</p>
						</a>
					</div>
					<div class="eui-col-md6 eui-textAlignC">
						<a href="#" class="eui-textIn1">
							<p class="eui-textNum"><span class="eui-color-yellow" id="time1">12</span> 个</p>
							<p class="name">今日新增预约</p>
						</a>
					</div>
				</div>
				<div class="eui-row eui-margin10 eui-padding10 eui-tab-card  eui-borderRadiusLR1">
					<div class="eui-borderB">
						<div class="eui-font18 eui-paddingT5">
							<i class='eui-icon eui-font24'>&#xe612;</i> 待回访客户
						</div>
						<table class="eui-table" id="returnPlanTable" e-filter="returnPlanTable"></table>
					</div>
					<div class="eui-borderB">
						<div class="eui-font18 eui-paddingT5">
							<i class='eui-icon eui-font24'>&#xe612;</i>待计划回访客户
						</div>
						<table class="eui-table" id="returnCustTable" e-filter="returnCustTable"></table>
					</div>
					<div class="eui-borderB">
						<div class="eui-font18 eui-paddingT5">
							<i class='eui-icon eui-font24'>&#xe612;</i> 今日值班医生
						<a class="eui-btn eui-btn-small eui-float-right" onclick="tongji()"><i class='eui-icon'>&#xe62c;</i>接诊统计</a>

						</div>
						<table class="eui-table" e-even e-skin="nob">
							<colgroup>
								<col width="100">
								<col>
							</colgroup>
							<thead>
								<tr>
									<th>姓名</th>
									<th>电话</th>
									<th>状态</th>
								</tr>
							</thead>
							<tbody id="zhiban">
							</tbody>
						</table>
					</div>
					<div class="eui-borderB">
						<div class="eui-font18 eui-paddingT20">
							<i class='eui-icon eui-font24'>&#xe60e;</i> 库存数量预警
						</div>
						<table class="eui-table" e-even e-skin="nob" id="kcslyj"></table>
					</div>
					<div class="eui-borderB">
						<div class="eui-font18 eui-paddingT20">
							<i class='eui-icon eui-font24'>&#xe60e;</i> 库存到期预警
						</div>
						<table class="eui-table" e-even e-skin="nob" id="kcdqyj"></table>
					</div>
				</div>
			</div>
			<div class="eui-col-md9">
				<div class="eui-tab-card eui-margin10">
					<div class="eui-row  eui-padding10   eui-borderRadiusLR1">
						<div class="eui-col-md6 eui-font18 eui-paddingT5">
							<i class='eui-icon eui-font24'>&#xe62d;</i> 订单收费列表
						</div>
					</div>
					<div class=" ">
						<!--条件搜索 start-->
						<div class="eui-form eui-form-search">
							<!-- 查询重置按钮-->
							<div class="eui-btn-group">
								<button class="eui-btn" onclick="sf_cx()">查询</button>
								<button class="eui-btn eui-btn-primary" onclick="sf_cz()">重置</button>
							</div>
							<!--查询条件-->
							<div class="eui-form-item" style="margin-left: -60px;">
								<label class="eui-form-label">客户姓名</label>
								<div class="eui-input-block">
									<input type="text" id="sfname" class="eui-input" placeholder="请输入查询关键字">
								</div>
							</div>
							<!--华丽的分割线-->

							<div class="clearfix"></div>
						</div>
						<!--条件搜索 end-->
						<div class="infoList">
							<table id="tableDemos" e-filter="tableDemoFilters"></table>
							<!--表格 end-->
						</div>
					</div>
				</div>
				<div class="eui-tab-card eui-margin10">
					<div class="eui-row  eui-padding10   eui-borderRadiusLR1">
						<div class="eui-col-md6 eui-font18 eui-paddingT5">
							<i class='eui-icon eui-font24'>&#xe637;</i> 今日预约
						</div>
						<div class="eui-col-md6 eui-textAlignR">
							<a href="###" class="eui-btn eui-btn-small" data-method="yyAdd">新增预约</a>
							<!--<a href="###" class="eui-btn eui-btn-small" onclick="orderAdd()">收费</a>-->
							<!--<a href="###" class="eui-btn eui-btn-small" onclick="custAdd()">新增客户</a>-->
						</div>
					</div>
					<div class="">
						<!--条件搜索 start-->
						<div class="eui-form eui-form-search">
							<!-- 查询重置按钮-->
							<div class="eui-btn-group">
								<button class="eui-btn" onclick="getYYlist()">查询</button>
								<button class="eui-btn eui-btn-primary" onclick="yy_cz()">重置</button>
							</div>
							<!--查询条件-->
							<div class="eui-form-item">
								<label class="eui-form-label">预约时间：</label>
								<div class="eui-input-block">
									<input type="text" class="eui-input" id="yyDate" placeholder="选择日期范围">
								</div>
							</div>
							<div class="eui-form-item">
								<label class="eui-form-label">预约医生：</label>
								<div class="eui-input-block">
									<select name="city" e-verify="required" e-search id="yyDoctor">
										<option value="">带搜索的选择框</option>
									</select>
								</div>
							</div>
							<div class="eui-form-item">
								<label class="eui-form-label">客户姓名/电话：</label>
								<div class="eui-input-block">
									<input type="text" class="eui-input" placeholder="请输入查询关键字" id="yyCustName">
								</div>
							</div>
							<div class="eui-form-item">
								<label class="eui-form-label">预约项目：</label>
								<div class="eui-input-block">
									<select name="city" e-verify="required" e-search id="yyProject">
										<option value="">带搜索的选择框</option>
									</select>
								</div>
							</div>
							<!--华丽的分割线-->

							<div class="clearfix"></div>
						</div>
						<!--条件搜索 end-->
						<div class="infoList">
							<!--表格 start-->
							<script type="text/html" id="barDemo">
								<div class="eui-btn-group">
									<a class="eui-btn eui-btn-primary eui-btn-mini" e-event="detail"><i class="eui-icon"title="账单">&#xe615;账单</i></a>
									<a class="eui-btn eui-btn-mini" e-event="log"><i class="eui-icon"title="记录">&#xe60e;记录</i></a>
									<a class="eui-btn eui-btn-bug  eui-btn-mini" e-event="xj"><i class="eui-icon"title="现金"> &#xe65e;现金</i></a>&nbsp;
									<a class="eui-btn eui-btn-bug  eui-btn-mini" e-event="zh"><i class="eui-icon"title="余额"> &#xe65e;余额</i></a>
								</div>
							</script>
							<table id="tableDemo" e-filter="tableDemoFilter"></table>
							<!--表格 end-->
						</div>
					</div>
				</div>
			</div>
		</div>

		<script type="text/html" id="layerContent">

			<div class="eui-tab-content">
				<!--左右边距大的表单开头-->
				<div class="">
					<!--左右边距小的表单开头-->
					<div class="">
						<div class="eui-tab-item eui-show">
							<div>
								<!--<div class="eui-row eui-searchTitle eui-marginB20">-->
								<!--<div class="eui-col-md6">-->
								<!--<span class="eui-panels-title1">预约信息</span>-->
								<!--</div>-->
								<!--</div>-->
								<div class="eui-row">
									<div class="eui-col-md12">
										<form class="eui-form eui-col-md10 eui-col-md-offset1 eui-marginT20 eui-tab-card eui-padding20" id="addForm" action="">
											<div class="eui-form-item">
												<label class="eui-form-label">客户姓名:</label>
												<div class="eui-input-inline">
													<a href="###" class="inputAfter" onclick="openCust()"><i class="eui-icon">&#xe612;</i></a>
													<input type="text" name="yyCustName" id="yyCust" e-verify="title" utocomplete="off" placeholder="姓名" class="eui-input">
													<input type="text" name="yyCustId" id="yyCustId" hidden="hidden">
												</div>
												<label class="eui-form-label width190">性别：</label>
												<div class="eui-input-inline">
													<input type="radio" id="man" name="yyCustSex" value="男" title="男">
													<input type="radio" id="woman" name="yyCustSex" value="女" title="女">
												</div>
											</div>
											<div class="eui-form-item">
												<label class="eui-form-label">年龄：</label>
												<div class="eui-input-inline">
													<input type="text" name="yyAge" id="yyAge" e-verify="title" autocomplete="off" placeholder="" class="eui-input">
												</div>
												<label class="eui-form-label">电话：</label>
												<div class="eui-input-inline">
													<input type="text" name="yyCustTel" id="yyCustTel" e-verify="title" autocomplete="off" placeholder="" class="eui-input">
												</div>
											</div>
											<div class="eui-form-item">
												<label class="eui-form-label">预约医生：</label>
												<div class="eui-input-inline">
													<select name="yyDoctor" id="yyDoctors" e-verify="required" e-search>
														<option value="">请选择预约医生</option>
													</select>
												</div>
												<label class="eui-form-label">预约项目：</label>
												<div class="eui-input-inline">
													<select name="yyProject" id="yyProjects" e-verify="required" e-search>
														<option value="">请选择预约项目</option>
													</select>
												</div>
											</div>
											<div class="eui-form-item">
												<label class="eui-form-label">预约就诊日期：</label>
												<div class="eui-input-inline">
													<input type="text" class="eui-input" name="yyDate" id="test1" placeholder="请选择预约就诊日期">
												</div>
												<label class="eui-form-label">预约就诊时间：</label>
												<div class="eui-input-inline">
													<input type="text" class="eui-input"  id="test2"  name="yyTime" placeholder="请选择预约时间">
												</div>
											</div>
											<div class="eui-form-item">
												<label class="eui-form-label">预约来源：</label>
												<div class="eui-input-inline">
													<select name="yySource" e-verify="required" e-search>
														<option value="">请选择预约来源</option>
														<option value="电话预约">电话预约</option>
														<option value="现场预约">现场预约</option>
														<option value="微信预约">微信预约</option>
													</select>
												</div>
												<label class="eui-form-label">备注：</label>
												<div class="eui-input-inline">
													<input type="text" class="eui-input" name="remark"
														   placeholder="备注">
												</div>
											</div>
										</form>
									</div>
								</div>
							</div>
						</div>

					</div>
					<!-- 删除分界线 -->
				</div>
				<!--左右边距小的表单结尾里面要删的东西要去掉-->
			</div>
			<!--左右边距大的表单结尾里面要删的东西要去掉-->
		</script>
		<script type="text/html" id="titleTpl">
			{{#  if(d.dist_day <= 0){ }}
				<p class="eui-color-red">{{d.dist_day}}</p>
			{{#  } else { }}
			{{d.dist_day}}
			{{#  } }}
		</script>
		<script type="text/javascript" src="../../../Scripts/jquery-1.9.0.min.js"></script>
		<script src="../../../Scripts/module/eui.js" charset="utf-8"></script>
		<script src="../../../Scripts/pack.ajax.js" type="text/javascript"></script>

		<!-- <script src="../../../Scripts/plugins/prism/prism.js"></script> -->
		<!-- <script src="../../../Scripts/plugins/prism/line-numbers.js"></script> -->

		<script src="../../../Scripts/main.js" charset="utf-8"></script>
		<script type="text/javascript" src="../../../Scripts/config.js"></script>
		<script type="text/javascript" src="../../../Scripts/date2format.js"></script>
		<script>
			var txt = "";
			var projectList = null;
			var doctorList = null;

			eui.use(['jquery', 'element', 'form', 'layedit', 'laydate', 'table', 'laytpl'], function() {
				var element = eui.element,
					form = eui.form,
					layer = eui.layer,
					layedit = eui.layedit,
					laydate = eui.laydate,
					table = eui.table,
					laytpl = eui.laytpl;

				var getTpl = $("#layerContent").html();
				laytpl(getTpl).render({}, function(html) {
					txt = html;
				});

				$("#uploadima").click(function() {
					window.open("../../../【华仁牙科】操作手册-门诊平台.docx");
				})

				laydate.render({
					elem: '#test-n1',
					position: 'static',
					mark: '',
					change: function(value, date, endDate) {}
				});
				//日期选择
				laydate.render({
					elem: '#dateTest'
				});
				//日期范围
				laydate.render({
					elem: '#yyDate'
				});
				//预约表格
				table.render({
					elem: '#tableDemo'
						//   ,height: 350
						//  ,height: 'full-200'       //该项为设置表格最大化自适应高度
						,
					even: true //开启隔行背景
						,
					skin: 'row',
					data: yylist,
					cols: [
						[{
							field: 'yyCode',
							title: '预约编号',
							minWidth: 150
						}, {
							field: 'yyDate',
							width: 120,
							title: '预约日期',
							templet: function(d) {
								if(d.yyDate != null && d.yyDate != "") {
									return new Date(d.yyDate).Format('yyyy-MM-dd');
								} else {
									return "";
								}
							},
							sort: true
						}, {
							field: 'yyTime',
							width: 120,
							title: '预约时间',
							sort: true
						}, {
							field: 'yyCustName',
							width: 90,
							title: '客户姓名',
							sort: true
						}, {
							field: 'yyCustSex',
							width: 60,
							title: '性别'
						}, {
							field: 'yyAge',
							width: 60,
							title: '年龄'
						}, {
							field: 'yyCustTel',
							width: 110,
							title: '联系电话'
						}, {
							field: 'yyDoctor',
							title: '预约医生',
							minWidth: 150
						}, {
							field: 'yyProject',
							title: '预约项目',
							minWidth: 150
						}, {
							field: 'yySource',
							title: '预约来源',
							minWidth: 150
						}, {
							field: 'remark',
							title: '预约备注',
							minWidth: 150
						}]
					],
					page: true,
					limits: [5, 10, 15],
					limit: 5 //每页默认显示的数量
				});
				//账单表格
				table.render({
					elem: '#tableDemos'
						//   ,height: 350
						//  ,height: 'full-200'       //该项为设置表格最大化自适应高度
						,
					even: true //开启隔行背景
						,
					skin: 'row',
					data: sflist,
					cols: [
						[{
							field: 'sf_stat',
							width: 80,
							title: '状态',
						}, {
							field: 'create_time',
							width: 150,
							title: '账单时间',
							templet: function(d) {
								return new Date(d.create_time).Format('yyyy-MM-dd hh:mm:ss')
							}
						}, {
							field: 'cust_name',
							width: 100,
							title: '客户姓名',
							templet: '#switchTpl'
						}, {
							field: 'sf_money',
							title: '订单金额',
							width: 80
						},
                        {
                            field: 'arrears',
                            title: '未付金额',
                            width: 80
                        },
                        {
                            field: 'prepaid',
                            title: '已付金额',
                            width: 80,
                            templet: function(d) {
                                return d.sf_money - d.arrears
                            }
                        },
						{
							field: 'doctor',
							title: '医生',
							width: 100
						}, {
							field: 'filed7',
							title: '操作',
							width: 240,
							toolbar: '#barDemo',
							unresize: true,
							fixed: 'right'
						}]
					],
					page: true,
					limits: [10, 20, 30],
					limit: 10 //每页默认显示的数量
				});
				//过期预警
                table.render({
                    elem: '#kcdqyj',
                    even: true,
                    method: 'post',
                    url: basePath+"/stock/getGqWarn",
                    skin: 'row',
                    cols: [[
                        {field: 'in_out_code',width: 80,title: '编码'}
                        ,{field: 'p_name',width: 110,title: '名称'}
                        ,{field: 'end_time',width: 90,title: '过期日期',templet:'<div>{{ new Date(d.end_time).Format("yyyy-MM-dd") }}</div>'}
                        ,{field: 'days',width: 80,title: '剩余天数'}
                        ,{field: 'num',width: 60,title: '数量'}
                    ]],
                    page: true,
                    limits: [10, 20, 30],
                    limit: 10 //每页默认显示的数量
                });
				//数量预警
                table.render({
                    elem: '#kcslyj',
                    even: true,
                    method: 'post',
                    url: basePath + "/stock/getwarn",
                    skin: 'row',
                    cols: [[
						 {field: 'product_name',width: 220,title: '名称'}
                        ,{field: 'stock_num',width: 90,title: '剩余数量'}
                        ,{field: 'warn_num',width: 90,title: '预警数量'}
                    ]],
                    page: true,
                    limits: [5, 20, 30],
                    limit: 5 //每页默认显示的数量
                });

				//回访计划表
                table.render({
                    elem: '#returnPlanTable'
                    ,method: 'post'
                    ,url: basePath+"/cust/return/indexList"
                    ,cols: [[ //标题栏
						 {field: 'cust_name', title: '姓名', width: 140,edit:"text"}
                        ,{field: 'return_time', title: '计划回访时间', width: 120,templet:'<div>{{ new Date(d.return_time).Format("yyyy-MM-dd") }}</div>'}
                        ,{field: 'dist_day', title: '距离天数', width: 80,templet:'#titleTpl'}
                        ,{	field: 'filed7',
                            title: '操作',
                            toolbar: '#planBar',
                            unresize: true,
                            fixed: 'right'}
                    ]]
                    ,page: true
                    , limits: [5, 10, 15]
                    , limit: 5 //每页默认显示的数量
                });
				//未计划客户表
                table.render({
                    elem: '#returnCustTable'
                    ,method: 'post'
                    ,url: basePath+"/cust/return/noPlanList"
                    ,cols: [[ //标题栏
						 {field: 'cust_name', title: '姓名', width: 80,edit:"text"}
                        ,{field: 'create_time', title: '挂号时间', width: 140,templet:'<div>{{ new Date(d.create_time).Format("yyyy-MM-dd") }}</div>'}
                        ,{	field: 'filed7',
                            title: '操作',
                            toolbar: '#planBar',
                            unresize: true,
                            fixed: 'right'}
                    ]]
                    ,page: true
                    , limits: [5, 10, 15]
                    , limit: 5 //每页默认显示的数量
                });

				//监听工具条
				table.on('tool(tableDemoFilters)', function(obj) {
					if(obj.event === 'detail') {
						layer.open({
							type: 2,
							title: '订单详情',
							shadeClose: true,
							shade: 0.3,
							maxmin: true, //开启最大化最小化按钮
							area: ['1100px', '780px'],
							content: '../order/order-info.html?id='+obj.data.sf_id,
							success: function(layero, index) {
								$.ajax({
									type: "post",
									url: basePath + "/customer/detail",
									async: true,
									data: {
										id: obj.data.cust_id
									},
									success: function(data) {
										var iframeWin = window[layero.find('iframe')[0]['name']];
										iframeWin.getDetail(data.data.custName,
											obj.data.sf_id, getTime(obj.data.create_time),
                                            getTimes(obj.data.create_time),obj.data.doctor,obj.data.cashier);
									}
								});
							}
						});
					} else if(obj.event === 'xj') {
						layer.open({
							type: 2,
							title: '现金收费',
							shadeClose: true,
							shade: 0.3,
							maxmin: true, //开启最大化最小化按钮
							area: ['1100px', '600px'],
							content: '../order/order-info.html?id='+obj.data.sf_id,
							success: function(layero, index) {
								$.ajax({
									type: "post",
									url: basePath + "/customer/detail",
									async: true,
									data: {
										id: obj.data.cust_id
									},
									success: function(data) {
										var iframeWin = window[layero.find('iframe')[0]['name']];
										iframeWin.show();
										iframeWin.getcustName(data.data.custName, data.data.custSex,
											obj.data.sf_id, getTime(data.data.custBirth),
											data.data.custAge);
									}
								});

							},
							end: function(index, layero) {
								getsflist();
							}
						});
					} else if(obj.event === 'zh') {
						$.ajax({
							type: "post",
							url: basePath + "/customer/detail",
							async: true,
							data: {
								id: obj.data.cust_id
							},
							success: function(data) {
								layer.confirm('当前账户余额为:<lable style="color:red;font-size:16px">' + data.data.money + '</lable>元<br>确定使用余额结账？', function(index) {
								    if(data.data.money === 0 || data.data.money === "0"){
								        layer.msg("余额不足，请及时充值！");
								        return;
									}
									$.ajax({
										type: "post",
										url: basePath + "/cust/sfjl/updates",
										async: true,
										data: {
											id: obj.data.sf_id,
											ids: obj.data.cust_id,
											money: obj.data.sf_money
										},
										success: function() {
											layer.msg('收费成功', {
												icon: 1,
												time: 2000 //2秒关闭（如果不配置，默认是3秒）
											});
											getsflist();
										}
									});
								});
							}
						});
					}else if(obj.event === 'log'){
                        layer.open({
                            type: 2,
                            title: '收费日志',
                            shadeClose: true,
                            shade: 0.3,
                            maxmin: true, //开启最大化最小化按钮
                            area: ['700px', '500px'],
                            content: '../order/order-log.html?sfId='+obj.data.sf_id,
                            success: function(layero, index) {
                            },
                        });
					}
				});

				//监听待计划回访客户的工具条
				table.on('tool(returnCustTable)', function(obj) {
					if(obj.event === 'detail') {
							window.parent.go_cust(obj.data.cust_name);
					}
				});
				//监听计划回访客户的工具条
				table.on('tool(returnPlanTable)', function(obj) {
					if(obj.event === 'detail') {
							window.parent.go_cust(obj.data.cust_name);
					}
				});

				//监听表格复选框选择
				table.on('checkbox(tableDemoFilter)', function(obj) {
					console.log(obj)
				});

				//监听工具条
				table.on('tool(tableDemoFilter)', function(obj) {
					var data = obj.data;
					if(obj.event === 'detail') {
						layer.msg('ID：' + data.id + ' 的查看操作');
					} else if(obj.event === 'del') {
						layer.confirm('真的删除行么', function(index) {
							obj.del();
							layer.close(index);
						});
					} else if(obj.event === 'edit') {
						layer.alert('编辑行：<br>' + JSON.stringify(data))
					}
				});
				var active = {
					yyAdd: function() {
						layer.open({
							type: 1,
							title: '新建预约',
							shadeClose: true,
							shade: 0.3,
							area: ['55%', '80%'],
							id: 'popPage', //防止重复弹出
							content: txt,
							btn: ['保存', '取消'],
							btnAlign: 'c', //按钮居中
							yes: function() {
								var obj = $("#addForm").serializeObject();
								if(obj["yyCustName"] === "") {
									layer.msg("请输入名称！");
								} else if(obj["yyDoctor"] === "") {
									layer.msg("请选择预约医生！");
								} else if(obj["yyProject"] === "") {
									layer.msg("请选择预约项目！");
								} else if(obj["yyDate"] === "") {
									layer.msg("请选择预约日期！");
								} else if(obj["yyTime"] === "") {
									layer.msg("请选择预约时间！");
								} else if(obj["yySource"] === "") {
									layer.msg("请选择预约来源！");
								} else {
									$.post(basePath + "/yy/manage/add", {
										json: JSON.stringify(obj)
									}, function(res) {
										if(res.code === 200) {
											layer.msg("添加成功！");
											getYYlist();
											getCount();
											layer.closeAll();
										} else {
											layer.msg(res.message);
										}
									});
								}
							},
							btn2: function() {
								layer.closeAll();
							}
						});
						var project = "<option value=''>请选择预约项目</option>\n";
						$.each(projectList, function(index, value) {
							project = project + "<option value='" + value.name + "'>" + value.name + "</option>\n";
						});
						$("#yyProjects").html(project);
						var doctor = "<option value=''>请选择预约医生</option>\n";
						$.each(doctorList, function(index, value) {
							doctor = doctor + "<option value='" + value.id + "'>" + value.userName + "</option>\n";
						});
						$("#yyDoctors").html(doctor);
						form.render();
						laydate.render({
							elem: '#test1'
						});
						laydate.render({
							elem: '#test2'
							,type:'time'
						});
					}
				};
				$('.eui-btn').on('click', function() {
					var othis = $(this),
						method = othis.data('method');
					active[method] ? active[method].call(this, othis) : '';
				});
			});

			function cut(id) {
				if(id == 'calendar') {
					$("#" + id).addClass("out").removeClass('in');
					$("#schedule").removeClass('out').addClass("in");
				} else {
					$("#" + id).addClass("out").removeClass('in');
					$("#calendar").removeClass("out").addClass('in');
				}
			}
			//初始化
			$(function() {
				$("#yyDate").val(getTime(new Date()));
				getsb(); //获取值班医生
				getCount(); //获取今日新增预约和今日预约数量
				getYYlist(); //获取预约表信息
				getsflist(); //获取收费信息表
				getdoc(); //获取医生
				project(); //获取项目
			});
			//今日值班医生
			function getsb() {
				$.ajax({
					type: "post",
					url: basePath + "/scheduling/plan/getsb",
					async: true,
					data: {
						id: JSON.parse(window.sessionStorage.getItem("user")).id
					},
					success: function(data) {
                        $("#zhiban").html("");

						var userlist = data.data;
						for(var i in userlist) {
							var user = userlist[i]
							if(user.standby2==0){
								user.standby2="空闲";
							}else{
								user.standby2="忙碌";
							}
							$("#zhiban").append('<tr>' +
								'<td>' + user.userName + '</td>' +
								'<td>' + user.mobile + '</td>' +
								'<td>' + user.standby2 + '</td>' +
								'</tr>');
						}
					}
				});
			}

			//时间格式转换
			function getTime(time) {
				if(time != '' && time != null && time != 'undefined') {
					return new Date(time).Format('yyyy-MM-dd');
				} else {
					return "";
				}

			}

            //时间格式转换
            function getTimes(time) {
                if(time != '' && time != null && time != 'undefined') {
                    return new Date(time).Format('hh:mm:ss');
                } else {
                    return "";
                }

            }

			//获取预约数量
			function getCount() {
				$.ajax({
					type: "post",
					url: basePath + "/yy/manage/getTime",
					async: true,
					success: function(data) {
						$("#time1").html(data.data.time1);
						$("#time2").html(data.data.time2);
					}
				});
			}

			var yylist;
			var sflist = [];

			//刷新预约信息
			function getYYlist() {
				$.ajax({
					type: "post",
					url: basePath + "/yy/manage/lists",
					async: true,
					data: {
						yyDate: $("#yyDate").val(),
						yyCustName: $("#yyCustName").val(),
						yyDoctor: $("#yyDoctor").val(),
						yyProject: $("#yyProject").val()
					},
					success: function(data) {
						yylist = data.data;
						if(data.data == null) {
							yylist = [];
						}
						if(eui.table != null) {
							eui.table.reload('tableDemo', {
								data: yylist
							});
						}
					}
				});
			}

			//刷新收费信息
			function getsflist() {
				$.ajax({
					type: "post",
					url: basePath + "/cust/sfjl/lista",
					async: true,
					data: {
						sf_name: $("#sfname").val()
					},
					success: function(data) {
						sflist = data.data;
						if(data.data == null) {
							sflist = [];
						}
						if(eui.table != null) {
							eui.table.reload('tableDemos', {
								data: sflist
							});
						}

					}
				});
			}

			//收费查询
			function sf_cx() {
				getsflist();
			}
			//收费重置
			function sf_cz() {
				$("#sfname").val("");
			}
			//预约重置
			function yy_cz() {
				$("#yyDate").val("");
				$("#yyCustName").val("");
				$("#yyDoctor").val("");
				$("#yyProject").val("");
				apply();
			}
			//获取项目
			function project() {
				$.ajax({
					type: "post",
					url: basePath + "/project/manage/getProject",
					async: true,
					success: function(data) {
						var str = '<option value="">带搜索的选择框</option>';
						var list = data.data;
						for(var i in list) {
							var user = list[i];
							str = str + '<option value="' + user.id + '">' + user.name + '</option>';
						}
						$('#yyProject').html(str);
					}
				});
			}

			//获取医生
			function getdoc() {
				$.ajax({
					type: "post",
					url: basePath + "/sec/user/getAllDoc",
					async: true,
					success: function(data) {
						doctorList = data.data;
						var str = '<option value="">带搜索的选择框</option>';
						var list = data.data;
						for(var i in list) {
							var user = list[i];
							str = str + '<option value="' + user.id + '">' + user.userName + '</option>';
						}
						$('#yyDoctor').html(str);
						apply();
					}
				});
			}

			//获取项目
			function project() {
				$.ajax({
					type: "post",
					url: basePath + "/project/manage/getProject",
					async: true,
					success: function(data) {
						projectList = data.data;
						var str = '<option value="">带搜索的选择框</option>';
						var list = data.data;
						for(var i in list) {
							var user = list[i];
							str = str + '<option value="' + user.name + '">' + user.name + '</option>';
						}
						$('#yyProject').html(str);
						apply();
					}
				});
			}

            function openCust(){
                var iframeWin;
                var pageU = layer.open({
                    type: 2
                    , title: "选择客户"
                    , area: ['1100px', '600px']  //宽度
                    , id: 'selectUser' //防止重复弹出
                    , content: '../cust/chooseCust.html'
                    , btn: ['确定', '取消']
                    , btnAlign: 'c' //按钮居中
                    , shade: 0.3 //不显示遮罩
                    , maxmin: true
                    ,success: function(layero, index){
                        var body = layer.getChildFrame('body', index);
                        iframeWin = window[layero.find('iframe')[0]['name']];
                    }
                    , yes: function () {
                        var userStr=iframeWin.getCheckUser();
                        if(userStr!=null&&userStr!=""){
                            var a=  userStr.split("|");
                            $("#yyCustId").val(a[0]);
                            $("#yyCust").val(a[1]);
                            if(a[2] === "男"){
                                $("#woman").removeAttr("checked","");
                                $("#man").attr("checked","");
                            }else{
                                $("#man").removeAttr("checked","");
                                $("#woman").attr("checked","");
                            }

                            $("#yyCustTel").val(a[3]);
                            $("#yyAge").val(a[4]);
                            apply();
                            layer.close(pageU);
                        }else {
                            iframeWin.msg();
                        }
                    }, btn2: function () {
                        layer.close(pageU);
                    }
                });
            }

			function apply() {
				eui.use(['element', 'form', 'layedit', 'laydate', 'table'], function() {
					eui.form.render();
				});
			}
			
			function tongji(){
				layer.open({
				    type: 2
				    , title: "统计"
				    , area: ['530px', '600px']  //宽度
				    , id: 'tongji' //防止重复弹出
				    , content: '../statistics/diagnostic.html'
				    , btn: ['取消']
				    , btnAlign: 'c' //按钮居中
				    , shade: 0.3 //不显示遮罩
				    , maxmin: true
					,shadeClose: true
					, btn2: function () {
				        layer.close(tongji);
				    }
				});
			}
			//设置定时任务刷新医生上班状态
            setInterval(function(){
                getsb();
                getsflist();
            },30000);
			
		</script>

		<script type="text/html" id="planBar">
			<div class="eui-btn-group">
				<a class="eui-btn eui-btn-primary eui-btn-mini" e-event="detail"><i class="eui-icon" title="查看">
					&#xe615;</i></a>
			</div>
		</script>
	</body>

</html>