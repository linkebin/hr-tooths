<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>添加员工信息</title>
  <meta name="renderer" content="webkit">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <link rel="stylesheet" href="../../../../Styles/themes/default/style.css"  media="all">
  <style>
    .error{
      color:  red;
    }
  </style>
</head>
<body class="ToolbarFixed">

<div class="toolbarH">
  <div class="title-bar">
    <div class="eui-btn-group float-right">
      <!--不需要图标时可以将<i class="eui-icon">图标字符</i>去掉；开发时请删除此注释-->
      <a href="javaScript:void(0)" class="eui-btn" onclick="addUser()">保存</a>
      <a href="javaScript:void(0)" class="eui-btn eui-btn-primary" onclick="window.close();" >关闭</a>
    </div>
    <span class="title-main">
      <i class="eui-icon eui-font24">&#xe62a;</i>
      员工信息维护
    </span>
    <span class="title-sub">
      请按实际情况维护
    </span>
  </div>
</div>

<div class="form-body eui-width1200">
<div class="form-title">员工信息表</div>

  <!--tab页 start-->
  <div class="eui-tab eui-tab-card">
    <ul class="eui-tab-title">
      <li class="eui-this">基本信息</li>
      <!--<li>其它信息</li>-->
    </ul>
    <div class="eui-tab-content eui-bg-white">
      <div class="eui-tab-item eui-show">


        <div class="title-bar eui-marginB10">
          <span class="title-main">
            <i class="eui-icon eui-font20">&#xe62d;</i>
            在职信息
          </span>
         </div>
      <form id="formId" onsubmit="return false;">
        <input type="hidden" name="headImg">
        <input type="hidden" name="orgId">

        <table class=" eui-form eui-form-table">
          <tr>
            <th>用户名称<i class="eui-icon eui-font12 eui-color-red">&#xe658;</i>：</th>
            <td><input type="text" class="eui-input" name="userName"  placeholder="" value=""></td>

            <th>账号 <i class="eui-icon eui-font12 eui-color-red">&#xe658;</i>：</th>
            <td><input type="text" class="eui-input" placeholder="" onblur="isExistForAccount()"  name="account" value=""></td>

            <td rowspan="4">

              <div class="eui-upload-drag eui-width100" id="uploadImg">
                <i class="eui-icon">&#xe67c;</i>
                <p>点击或将图像拖拽到此处</p>
              </div>

            </td>

          </tr>
          <tr>
            <th>密码 <i class="eui-icon eui-font12 eui-color-red">&#xe658;</i>：</th>
            <td><input type="password" name="userPass" class="eui-input" placeholder=""></td>

            <th>手机号码 <i class="eui-icon eui-font12 eui-color-red">&#xe658;</i>：</th>
            <td><input type="text" name="mobile" class="eui-input" placeholder=""></td>

          </tr>

          <tr>
            <th>邮箱：</th>
            <td><input type="text" class="eui-input" name="email" placeholder=""></td>

            <th>性别 ：</th>
            <td>
              <input type="radio" name="sex" value="男" title="男" checked>
              <input type="radio" name="sex" value="女" title="女">
            </td>
          </tr>

          <tr>
            <th>证件类型 ：</th>
            <td >
              <input type="text" class="eui-input" name="cType" placeholder="">
            </td>
            <th>证件号码：</th>
            <td class="">
              <input type="text" style="width:360px"  name="cMum" class="eui-input" placeholder="">
            </td>
          </tr>
          <tr>
            <th>政治面貌：</th>
            <td>
              <input type="text" class="eui-input" name="politicalStatus" placeholder="">
            </td>
            <th>婚姻状态：</th>
            <td colspan="2">
              <input type="radio" name="mStatus" value="未婚" title="未婚" checked>
              <input type="radio" name="mStatus" value="已婚" title="已婚">
            </td>
          </tr>

          <tr>
            <th>籍贯：</th>
            <td  class="" >
              <input type="text" class="eui-input" name="nativePlace" placeholder="">
            </td>
            <th>状态：</th>
            <td colspan="2">
              <input type="radio" name="status" value="启用" title="启用" checked>
              <input type="radio" name="status" value="禁用" title="禁用">
            </td>
          </tr>
          <tr>
            <th>组织：</th>
            <td  class="" colspan="4">
              <div  onclick="checkOrg()" >
                  <input type="text" class="eui-input"  name="orgName" id="orgName" placeholder="点击选择" disabled>
                  <label  id="orgNameLabel" class="error" style="display: none">请选择组织</label>
              </div>
            </td>
          </tr>
          <tr>
            <th>地址：</th>
            <td class="select-col3"  >
              <div id="ld" data-toggle="distpicker">
                  <select  style="height: 30px" id="province" e-ignore  name="province">

                  </select>

                  <select style="height: 30px" id="city" e-ignore  name="city">

                  </select>

                  <select  style="height: 30px" id="district" e-ignore name="district">

                  </select>
                <label  id="addrs" class="error" style="display: none">请选择地址</label>

              </div>

            </td>
            <td colspan="3">
              <input type="text"   name="detailedAddr" class="eui-input" placeholder="请输入详细地址">
            </td>
          </tr>
        </table>
        <input type="submit" id="sub" style="display: none;" value="提交"/>
      </form>

      </div>
      <div class="eui-tab-item">





      </div>
    </div>
  </div>

  <!--tab页 end-->


</div>

<script src="../../../../Scripts/module/eui.js" charset="utf-8"></script>


<script type="text/javascript" src="../../../../Scripts/jquery-1.9.0.min.js"></script>
<script src="../../../../Scripts/libs/jquery-ui/jquery-ui.js" type="text/javascript"></script>
<script src="../../../../Scripts/libs/jquery-ui/jquery.layout.js" type="text/javascript"></script>
<script src="../../../../Scripts/plugins/jquery.cookie.js" type="text/javascript"></script>
<script src="../../../../Scripts/config.js" type="text/javascript"></script>
<script src="../../../../Scripts/pack.ajax.js" type="text/javascript"></script>
<script src="../../../../Scripts/plugins/jquery.validate.js"></script>
<script src="../../../../Scripts/plugins/md5/md5.min.js" type="text/javascript"></script>


<script src="../../../../Scripts/distpicker.data.js" type="text/javascript"></script>
<script src="../../../../Scripts/distpicker.js" type="text/javascript"></script>
<script>


  //表单
  eui.use(['element','form', 'layedit', 'laydate','table','upload'], function(){

    var element = eui.element
            ,form = eui.form
            ,layer = eui.layer
            ,layedit = eui.layedit
            ,laydate = eui.laydate
            ,table = eui.table
            ,upload = eui.upload;

    //拖拽上传
    upload.render({
      elem: '#uploadImg'
      ,url: basePath+'/upload/comUploadImg'
      ,done: function(res){
        console.log(res);
        var message="";
        if(res.code==200){
          message="上传成功";
          var htmls="<img style='width: 150px;height: 160px' src='"+basePath+res.data+"'>";
          $("#uploadImg").html(htmls);
          $("[name='headImg']").val(res.data);
        }else{
          message="上传失败";
        }


        layer.msg(message, {
          time: 1500 //1秒关闭（如果不配置，默认是3秒）
        });
      }
    });

    //常规用法
    laydate.render({
      elem: '#dateTest'
    });
    //日期范围
    laydate.render({
      elem: '#dateTest2'
      ,range: true
    });





  });

 $(function(){

   jQuery.validator.addMethod("isMobile", function (value, element) {
     var length = value.length;
     var mobile = /^(13[0-9]{9})|(18[0-9]{9})|(14[0-9]{9})|(17[0-9]{9})|(15[0-9]{9})$/;
     return this.optional(element) || (length == 11 && mobile.test(value));
   }, "请正确填写您的手机号码");
   jQuery.validator.addMethod("isProvincePNo", function(value, element) {
     return this.optional(element) || value!='—— 省 ——';
   }, "请选择省份");
   $("#formId").validate({
     rules: {
       userName: {
         required: true
       },
       account: {
         required: true
       },
       userPass: {
         required: true
       },
       mobile: {
         required: true,
         minlength: 11,
         isMobile: true
       },
       detailedAddr: {
         required: true
       }
     },
     messages: {
       userName: {
         required: "请输入用户名称"
       },
       account: {
         required: '请输入账号'
       },
       userPass: {
         required: '请输入密码'
       },
       mobile: {
         required: '请输入手机号码',
         minlength: "联系电话不能小于11个字符",
         isMobile: "请正确填写手机号码"
       },
       detailedAddr: {
         required:  '请输入详细地址'
       }

     },
     submitHandler: function () {

       if($("#province").val()=='—— 省 ——' || $("#city").val()=='—— 市 ——'){
         $("#addrs").show();
         return;
       }
       if($("[name='orgId']").val()==''){
          $("#orgNameLabel").show();
         return;
       }

       var formObj=$("#formId").serializeObject();
       formObj.userPass=md5(formObj.userPass);

       var province=$("[name='province']").val();
       var city=$("[name='city']").val();
       var area=$("[name='district']").val();
       var detailedAddr=$("[name='detailedAddr']").val();

       //添加地址
       formObj.addr=province+"#"+city+"#"+area+"#"+detailedAddr;
       var params=JSON.stringify(formObj);
       var indexs = layer.load(2); //加载
       $.post(basePath+"/sec/user/addSecUser",{param:params},function(result){
         if (result.code==200) {
           layer.closeAll();
           layer.msg('保存成功！', {
             icon: 1,
             time: 1500 //1秒关闭（如果不配置，默认是3秒）
           });
           setTimeout(function () {
             window.opener.location.href = window.opener.location.href;
             window.close();
           }, 1000);
         } else {
           layer.close(indexs);
           layer.msg('保存失败！', {
             time: 1500 //1秒关闭（如果不配置，默认是3秒）
           });
         }

       });
     }
   });

 });

function  addUser(){
  return $("#sub").click();
}

  //选择部门
  function  checkOrg(){

    var iframeWin;
    eui.use(['jquery','element','form','table'], function(){
      var form = eui.form
              ,layer = eui.layer;
      var pageU = layer.open({
        type: 2
        , title: "选择组织"
        , area: ['800px', '600px']  //宽度
        , id: 'selectUser' //防止重复弹出
        , content:'checkOrg.html'
        , btn: ['确定', '取消']
        , btnAlign: 'c' //按钮居中
        , shade: 0 //不显示遮罩
        , maxmin: true
        ,success: function(layero, index){

          var body = layer.getChildFrame('body', index);
          iframeWin = window[layero.find('iframe')[0]['name']]; //得到iframe页的窗口对象，执行iframe页的方法：
          //  body.find('input').val('Hi，我是从父页来的')
        }
        , yes: function () {
          var orgStr=iframeWin.getCheckOrg();
          if(orgStr!=null&&orgStr!=""){
            var a=  orgStr.split("|");
              $("[name='orgId']").val(a[0]);
              $("#orgName").val(a[1]);
            if(a[2]=="门诊"){
                layer.confirm("您选择添加人员至该门诊，该人员将作为管理员拥有门诊平台全部权限!",{btn:['我知道了！']})
            }
              layer.close(pageU);
          }else {
            layer.msg("请选择组织部门！");
          }
        }, btn2: function () {
          layer.close(pageU);
        }
      });
    });
  }
  //判断账号是否存在
  function isExistForAccount(){
    eui.use(['jquery','element','form','table'], function(){
      var form = eui.form
          ,layer = eui.layer;
         var account=  $("[name='account']").val();
         var indexs = layer.load(2); //加载
          $.get(basePath+"/sec/user/isExistForAccount",{account:account},function(result){
              if (result.code==200) {
                layer.closeAll();
              } else {
                layer.close(indexs);
                layer.msg(result.message);
                $("[name='account']").val("");
              }

          });
      });

  }


</script>
</body>
</html>
